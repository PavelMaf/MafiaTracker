# Трекер мафия — Оборотни

Локальный трекер для ведущего (без серверов и логинов). Данные сохраняются в IndexedDB, поддерживается экспорт/импорт JSON, автоснимки (snapshots) и «кнопка паники».

## Запуск

```bash
npm install
npm run dev
```

## Тесты

```bash
npm run test
```

## Сборка

```bash
npm run build
```

## Event model (event sourcing)

- Все изменения происходят через `events[]`.
- `applyEvent` пересчитывает состояние на основе событий.
- После каждого события происходит автосохранение в IndexedDB.
- Снимки создаются каждые 10 событий, хранится 50 последних.
- Panic: восстановление из последнего снимка и применение хвостовых событий.

Ключевые файлы:
- `src/domain/applyEvent.ts` — применение событий.
- `src/domain/roles.ts` — реестр ролей.
- `src/domain/settings.ts` — настройки правил.
- `src/storage` — Dexie/IndexedDB, экспорт/импорт, снимки.

## Assumptions (настройки по неоднозначным описаниям)

> В брифе есть обрывы и альтернативы, поэтому спорные моменты вынесены в настройки с безопасными дефолтами.

- **Мученица**: режим по умолчанию — дневная жертва вместо приговорённого (`martyrMode = sacrifice`).
- **Телохранитель**: повторная защита одного игрока подряд запрещена (`bodyguardRepeatProtect = disallow`).
- **Провидцы**: по умолчанию показывают команду, а не роль (`seerDetectMode = team`).
- **Волчонок**: по умолчанию после смерти включается двойная охота (`wolfCubRevengeMode = doubleHunt`).
- **Вампиры**: жертва умирает после дневного голосования (`vampireKillTiming = dayAfterVote`).
- **Секта**: наследование лидерства выключено (`cultLeaderInherit = false`).

Все эти параметры доступны на странице **Settings**.
